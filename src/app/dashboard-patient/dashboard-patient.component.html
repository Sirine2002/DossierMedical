<mat-sidenav-container>
  <mat-sidenav-content>
    <app-navbar></app-navbar>
    <div class="content">
      <div class="dossier-container" style="display: flex; gap: 20px; flex-direction: row-reverse;">

        <!-- ‚úÖ Zone filtre -->
        <mat-card style="padding: 24px; border-radius: 16px; background-color: #ffffff; box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);">
          <mat-card-title style="font-size: 20px; font-weight: 600; color: #1976d2; margin-bottom: 16px;">
            <img src="../../assets/images/filtre.png" style="height: 20px;width: 20px;"> Filtre automatique
            
          </mat-card-title>
        <!-- üîç Filtres automatiques -->
          <form [formGroup]="filtreForm" style="display: flex; flex-direction: column; gap: 20px;">
        
            <!-- Filtre par date -->
            <mat-form-field appearance="fill" class="full-width">
              <mat-label>Date de cr√©ation</mat-label>
              <input matInput [matDatepicker]="picker" formControlName="dateDebut" placeholder="Choisir une date">
              <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-datepicker #picker></mat-datepicker>
            </mat-form-field>
        
            <!-- Filtre par √©tat -->
            <mat-form-field appearance="fill" class="full-width">
              <mat-label>√âtat</mat-label>
              <mat-select formControlName="etat">
                <mat-option value="">Tous</mat-option>
                <mat-option value="actif">Actif</mat-option>
                <mat-option value="non actif">Non actif</mat-option>
              </mat-select>
            </mat-form-field>
          </form>
          <mat-card style="margin-top: 20px;">
            <mat-calendar></mat-calendar>
          </mat-card>
          
        </mat-card>
        
        

        <!-- ‚úÖ Liste des dossiers -->
        <mat-card class="dossiers-list" style="flex: 2; overflow-y: auto;">
          <mat-card-header>
            <mat-card-title class="costum-color1">Dossier M√©dical</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div *ngFor="let dossier of dossiersFiltres">
              <div class="dossier">
                <b class="costum-color2">N¬∞{{ formatNumero(dossier.dossier.numero) }}</b>
                <p>{{ dossier.dossier.dateCreation | date: 'dd/MM/yyyy' }}</p>
                <span class="custom-badge">{{ dossier.dossier.etat }}</span>
                <br />

                <!-- ‚úÖ Fiches de soin -->
                <mat-card-title>
                  <p><strong>Fiches de soin</strong></p>
                </mat-card-title>

                <mat-card *ngFor="let fiche of dossier.ficheSoin" class="example-card custom-card" appearance="outlined">
                  <div class="card-horizontal">
                    <img src="../../assets/images/fiche.png" class="card-image"
                      alt="Shiba Inu" style="margin-top: 10px;">
                    <div class="card-text">
                      <mat-card-title>
                        <p><strong>Num√©ro: </strong>{{ fiche.numero }}</p>
                      </mat-card-title>
                      <mat-card-title>
                        <p><strong>Date: </strong>{{ fiche.dateCreation }}</p>
                      </mat-card-title>
                      <mat-card-title>
                        <p><strong>Agent: </strong>{{ fiche.agentCreateur }}</p>
                      </mat-card-title>
                      <mat-card-title>
                        <p><strong>Adresse: </strong>{{ fiche.adresseCreateur }}</p>
                      </mat-card-title>
                      <mat-card-title>
                        <button mat-icon-button color="primary" matTooltip="Voir l'image" (click)="voirPlus(fiche)">
                          <mat-icon>visibility</mat-icon>
                        </button>
                        <button mat-icon-button color="accent" matTooltip="T√©l√©charger l'image" (click)="telechargerDonneesFiche(fiche)">
                          <mat-icon>download</mat-icon>
                        </button>
                      </mat-card-title>
                    </div>
                  </div>
                </mat-card>
                <hr>

                <!-- ‚úÖ Images m√©dicales -->
                <mat-card-title>
                  <p><strong>Images M√©dicales</strong></p>
                </mat-card-title>
                <div *ngFor="let dossier of dossiersFiltres">
                  <mat-card class="example-card custom-card" appearance="outlined">
                  
                    <ng-container *ngFor="let img of dossier.imageMedicale | slice:-3">
                      <div class="card-horizontal">
                        <img [src]="img.image" class="card-image" alt="Image m√©dicale" style="margin-top: 25px; ">
                        <div class="card-text">
                          <mat-card-title>
                            <p><strong>Num√©ro:</strong> {{ img.numero }}</p>
                          </mat-card-title>
                          <mat-card-title>
                            <p><strong>Date:</strong> {{ img.dateCreation }}</p>
                          </mat-card-title>
                          <mat-card-title>
                            <p><strong>Agent:</strong> {{ img.agentCreateur }}</p>
                          </mat-card-title>
                          <mat-card-title>
                            <p><strong>Adresse:</strong> {{ img.adresseCreateur }}</p>
                          </mat-card-title>
                          <mat-card-title>
                            <button mat-icon-button color="primary" matTooltip="Voir l'image" (click)="voirImage(img.image)">
                              <mat-icon>visibility</mat-icon>
                            </button>
                            <a [href]="img.image" download>
                              <button mat-icon-button color="accent" matTooltip="T√©l√©charger l'image">
                                <mat-icon>download</mat-icon>
                              </button>
                            </a>
                          </mat-card-title>
                        </div>
                      </div>
                    </ng-container>
                
                    <!-- <button mat-button color="primary" (click)="voirImages(dossier)">Voir plus</button> -->
                  </mat-card>
                </div>
                
                <hr>
                
                


                <!-- ‚úÖ Analyses m√©dicales -->

                <mat-card-title>
                  <p><strong>Analyses m√©dicales</strong></p>
                </mat-card-title>

                <mat-card class="example-card custom-card" appearance="outlined">
                  <div class="card-horizontal">
                    <img src="https://material.angular.io/assets/img/examples/shiba2.jpg" class="card-image"
                      alt="Shiba Inu" style="margin-top: 25px;">
                    <div class="card-text">
                      <mat-card-title>
                        <p><strong>Num√©ro:</strong></p>
                      </mat-card-title>
                      <mat-card-title>
                        <p><strong>Date:</strong></p>
                      </mat-card-title>
                      <mat-card-title>
                        <p><strong>Agent:</strong></p>
                      </mat-card-title>
                      <mat-card-title>
                        <p><strong>Adresse:</strong></p>
                      </mat-card-title>
                      <mat-card-title>
                        <button mat-icon-button color="primary" matTooltip="Voir l'image">
                          <mat-icon>visibility</mat-icon>
                        </button>
                        <button mat-icon-button color="accent" matTooltip="T√©l√©charger l'image">
                          <mat-icon>download</mat-icon>
                        </button>
                      </mat-card-title>
                    </div>
                  </div>
                </mat-card>
                <style>
                  .custom-card {
                    width: 100%;
                  }

                  .card-horizontal {
                    display: flex;
                    align-items: flex-start;
                    gap: 16px;
                  }

                  .card-image {
                    width: 200px;
                    height: 150px;
                    object-fit: cover;
                    border-radius: 4px;
                  }

                  .card-text {
                    flex: 1;
                  }
                </style>