<mat-sidenav-container style="margin-right: 9%;margin-left:9%">
  <mat-sidenav-content>
    <app-navbar></app-navbar>
    <div class="content">
      <div class="dossier-container" style="display: flex; gap: 20px; flex-direction: row-reverse;">

        <!-- ✅ Zone filtre -->
        <mat-card
        style="padding: 24px; border-radius: 16px; background-color: #ffffff; box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);">
        <mat-card-title style="font-size: 20px; font-weight: 600; color: #1976d2; margin-bottom: 16px;">
          <img src="../../assets/images/filtre.png" style="height: 20px;width: 20px;"> Filtre automatique
        </mat-card-title>
        
        <form [formGroup]="filtreForm" style="display: flex; flex-direction: column; gap: 20px;">
          
          <!-- Filtre par date -->
          <mat-form-field appearance="fill" class="full-width">
            <mat-label>Date de création</mat-label>
            <input matInput [matDatepicker]="picker" formControlName="dateDebut" placeholder="Choisir une date">
            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
          </mat-form-field>
          
          <!-- Filtre par type de fichier -->
          <mat-form-field appearance="fill" class="full-width">
            <mat-label>Type de fichier</mat-label>
            <mat-select formControlName="typeFichier">
              <mat-option value="">Tous</mat-option>
              <mat-option value="image">Image</mat-option>
              <mat-option value="analyse">Analyse</mat-option>
              <mat-option value="fiche_soin">Fiche de soin</mat-option>
            </mat-select>
          </mat-form-field>
          
          <!-- Filtre par agent -->
          <mat-form-field appearance="fill" class="full-width">
            <mat-label>Nom de l'agent</mat-label>
            <input matInput formControlName="nomAgent" placeholder="Nom de l'agent">
          </mat-form-field>

        </form>
        
      
      </mat-card>

        <!-- ✅ Liste des dossiers -->
        <mat-card class="dossiers-list" style="flex: 2; overflow-y: auto;">
          <mat-card-header>
            <mat-card-title class="costum-color1">Dossier Médical</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div *ngFor="let dossier of dossiersFiltres">
              <div class="dossier">
                <b class="costum-color2">N°{{ formatNumero(dossier.dossier.numero) }}</b>
                <p>{{ dossier.dossier.dateCreation | date: 'dd/MM/yyyy' }}</p>
                <span class="custom-badge">{{ dossier.dossier.etat }}</span>
                <br />

                <!-- ✅ Fiches de soin -->
                <mat-card-title>
                  <p style="font-size: 24px; font-weight: bold; margin: 10px 0;">Fiches de soin</p>
                </mat-card-title><br />
                <div *ngFor="let fiche of dossier.ficheSoin | slice: -2" style="display: flex; flex-direction: column;">
                  <div style="display: flex; align-items: center; flex-wrap: wrap; flex-direction: row-reverse;gap: 15px;">
                    <div style="flex: 1; text-align: left; padding:0%">
                      <p style="font-size: 18px; line-height: 1.8;max-width: 900px; margin: 0 auto;">
                        <strong>Numéro:</strong>{{ fiche.numero }}<br />
                        <strong>Date: </strong>{{ fiche.dateCreation }}<br />
                        <strong>Agent: </strong>{{ fiche.agentCreateur }}<br />
                        <strong>Adresse: </strong>{{ fiche.adresseCreateur }}<br />
                        <button mat-icon-button color="primary" matTooltip="Voir l'image" (click)="voirPlus(fiche)">
                          <mat-icon>visibility</mat-icon>
                        </button>
                        <button mat-icon-button color="accent" matTooltip="Télécharger l'image" (click)="telechargerDonneesFiche(fiche)">
                          <mat-icon>download</mat-icon>
                        </button>
                      </p>
                    </div>
                    <img src="../../assets/images/fiche.png" style="width:17%; max-width: 17%; ">
                  </div>
                </div>
                <div style="display: flex; justify-content: flex-end;">
                  <button mat-flat-button color="primary" (click)="voirFiches(dossier)" style="font-size: 14px;">
                    Voir plus
                  </button>
                </div>
                <hr/>

                <!-- ✅ Images médicales -->
                <mat-card-title>
                  <p style="font-size: 24px; font-weight: bold; margin: 10px 0;">Images médicales</p>
                </mat-card-title><br />
                <div *ngFor="let img of dossier.imageMedicale | slice: -2" style="display: flex; flex-direction: column;">
                  <div style="display: flex; align-items: center; flex-wrap: wrap; flex-direction: row-reverse;gap: 15px;">
                    <div style="flex: 1; text-align: left; padding:0%">
                      <p style="font-size: 18px; line-height: 1.8;max-width: 900px; margin: 0 auto;">
                        <strong>Numéro:</strong>{{ img.numero }}<br />
                        <strong>Date: </strong>{{ img.dateCreation }}<br />
                        <strong>Agent: </strong>{{ img.agentCreateur }}<br />
                        <strong>Adresse: </strong>{{ img.adresseCreateur }}<br />
                        <button mat-icon-button color="primary" matTooltip="Voir l'image" (click)="voirImage(img.image)">
                          <mat-icon>visibility</mat-icon>
                        </button>
                        <button mat-icon-button color="accent" matTooltip="Télécharger l'image" >
                          <mat-icon>download</mat-icon>
                        </button>
                      </p>
                    </div>
                    <img [src]="img.image" alt="Image médicale" style="width:17%; max-width: 17%;height: 40%;">
                  </div>
                </div>
                <div style="display: flex; justify-content: flex-end;">
                  <button mat-flat-button color="primary" (click)="voirImages(dossier)" style="font-size: 14px;">
                    Voir plus
                  </button>
                </div>
                <hr/>
                
                <!-- ✅ Analyses médicales -->
                <mat-card-title>
                  <p style="font-size: 24px; font-weight: bold; margin: 10px 0;">Analyses médicales</p>
                </mat-card-title>
                <br />
                <div *ngFor="let analyse of dossier.analyseMedicale | slice: -2" style="display: flex; flex-direction: column;">
                  <div style="display: flex; align-items: center; flex-wrap: wrap; flex-direction: row-reverse;gap: 15px;">
                    <div style="flex: 1; text-align: left; padding:0%">
                      <p style="font-size: 18px; line-height: 1.8;max-width: 900px; margin: 0 auto;">
                        <strong>Numéro:</strong>{{ analyse.numero }}<br />
                        <strong>Date: </strong>{{ analyse.dateCreation }}<br />
                        <strong>Agent: </strong>{{ analyse.agentCreateur }}<br />
                        <strong>Adresse: </strong>{{ analyse.adresseCreateur }}<br />
                        <button mat-icon-button color="primary" matTooltip="Voir l'image" (click)="voirImage(analyse.fichier)">
                          <mat-icon>visibility</mat-icon>
                        </button>
                        <button mat-icon-button color="accent" matTooltip="Télécharger l'image" >
                          <mat-icon>download</mat-icon>
                        </button>
                      </p>
                    </div>
                    <img [src]="analyse.fichier" alt="Analyse médicale" style="width:17%; max-width: 17%;">
                  </div>
                </div>
                <div style="display: flex; justify-content: flex-end;">
                  <button mat-flat-button color="primary" (click)="voirAnalyses(dossier)" style="font-size: 14px;">
                    Voir plus
                  </button>
                </div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>
